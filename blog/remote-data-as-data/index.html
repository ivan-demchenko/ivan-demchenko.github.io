<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Remote Data as Data | Ivan's blog</title><meta name=keywords content="TypeScript"><meta name=description content="Today I want to talk about an interesting (though not new) idea for representing remote resources. In fact, any resource that takes some time to retrieve. But most often we talk about network resources. At the same time, we&rsquo;re going to do a bit of TypeScript gymnastics.
Data type for side effects The state of a remote resource can be represented in four ways:
Idle - we haven&rsquo;t even requested the resource yet Loading - we have requested the resource, but the operation is not yet complete Ready<D> - we have the data Error<E> - something has gone wrong So, using a discriminated union feature of TypeScript, we can create a type for this situation:"><meta name=author content><link rel=canonical href=https://ivan-demchenko.github.io/blog/remote-data-as-data/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ivan-demchenko.github.io/static/icon.png><link rel=icon type=image/png sizes=16x16 href=https://ivan-demchenko.github.io/static/icon16.png><link rel=icon type=image/png sizes=32x32 href=https://ivan-demchenko.github.io/static/icon32.png><link rel=apple-touch-icon href=https://ivan-demchenko.github.io/static/icon.png><link rel=mask-icon href=https://ivan-demchenko.github.io/static/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VHCCQB5KTN"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VHCCQB5KTN")</script><meta property="og:title" content="Remote Data as Data"><meta property="og:description" content="Today I want to talk about an interesting (though not new) idea for representing remote resources. In fact, any resource that takes some time to retrieve. But most often we talk about network resources. At the same time, we&rsquo;re going to do a bit of TypeScript gymnastics.
Data type for side effects The state of a remote resource can be represented in four ways:
Idle - we haven&rsquo;t even requested the resource yet Loading - we have requested the resource, but the operation is not yet complete Ready<D> - we have the data Error<E> - something has gone wrong So, using a discriminated union feature of TypeScript, we can create a type for this situation:"><meta property="og:type" content="article"><meta property="og:url" content="https://ivan-demchenko.github.io/blog/remote-data-as-data/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-01-29T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-29T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Remote Data as Data"><meta name=twitter:description content="Today I want to talk about an interesting (though not new) idea for representing remote resources. In fact, any resource that takes some time to retrieve. But most often we talk about network resources. At the same time, we&rsquo;re going to do a bit of TypeScript gymnastics.
Data type for side effects The state of a remote resource can be represented in four ways:
Idle - we haven&rsquo;t even requested the resource yet Loading - we have requested the resource, but the operation is not yet complete Ready<D> - we have the data Error<E> - something has gone wrong So, using a discriminated union feature of TypeScript, we can create a type for this situation:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://ivan-demchenko.github.io/blog/"},{"@type":"ListItem","position":2,"name":"Remote Data as Data","item":"https://ivan-demchenko.github.io/blog/remote-data-as-data/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Remote Data as Data","name":"Remote Data as Data","description":"Today I want to talk about an interesting (though not new) idea for representing remote resources. In fact, any resource that takes some time to retrieve. But most often we talk about network resources. At the same time, we\u0026rsquo;re going to do a bit of TypeScript gymnastics.\nData type for side effects The state of a remote resource can be represented in four ways:\nIdle - we haven\u0026rsquo;t even requested the resource yet Loading - we have requested the resource, but the operation is not yet complete Ready\u0026lt;D\u0026gt; - we have the data Error\u0026lt;E\u0026gt; - something has gone wrong So, using a discriminated union feature of TypeScript, we can create a type for this situation:","keywords":["TypeScript"],"articleBody":"Today I want to talk about an interesting (though not new) idea for representing remote resources. In fact, any resource that takes some time to retrieve. But most often we talk about network resources. At the same time, we’re going to do a bit of TypeScript gymnastics.\nData type for side effects The state of a remote resource can be represented in four ways:\nIdle - we haven’t even requested the resource yet Loading - we have requested the resource, but the operation is not yet complete Ready - we have the data Error - something has gone wrong So, using a discriminated union feature of TypeScript, we can create a type for this situation:\nRemoteData Now we need some way(s) to construct a value of this type. Each of the variants we listed above is a constructor. Here’s how we can construct them:\nconst Idle = () =\u003e ({ _kind: 'Idle' as const }); const Loading = () =\u003e ({ _kind: 'Loading' as const }); const Ready = \u003cD, \u003e(data: D) =\u003e ({ _kind: 'Ready' as const, data }); const Error = \u003cE, \u003e(error: E) =\u003e ({ _kind: 'Error' as const, error }); Those are just simple functions that return simple objects. Please note as const that help to narrow the type from string to a corresponding literal. Using a ReturnType utility we can reuse those constructors the following way:\ntype RemoteData\u003cD, E\u003e = | ReturnType\u003ctypeof Idle\u003e | ReturnType\u003ctypeof Loading\u003e | ReturnType\u003ctypeof Ready\u003cD\u003e\u003e | ReturnType\u003ctypeof Error\u003cE\u003e\u003e Therefore, the _kind field acts as a discriminator for this union type.\nOkay, now we can use this type in other function. For example,\nfunction renderRemoteString(data: RemoteData\u003cstring, SomeError\u003e) { // ... } At this point, we need to talk about a mental model for Sum types (or discriminated unions). All these constructors return a value of type RemoteData. In other words, the value of type RemoteData can be constructed in 4 ways. Therefore, within the renderRemoteString function, we don’t really know which constructor has been used. So we need to deal with all 4:\nfunction renderRemoteString(data: RemoteData\u003cstring, SomeError\u003e) { switch (data._kind) { case 'Idle': return //... case 'Loading': return //... case 'Ready': return //... case 'Error': return //... } } However, TypeScript doesn’t force us to handle all cases in this switch. Other languages do though. Let’s have a look. This is Rescript:\ntype remoteData\u003c'd, 'e\u003e = | Idle | Loading | Ready('d) | Error('e) let render = (data: remoteData\u003c'd, 'e\u003e) =\u003e switch data { | Idle =\u003e \"idle\" | Loading =\u003e \"Loading\" | Ready(_data) =\u003e \"Ready\" | Error(_err) =\u003e \"Error\" } if we “forget” about, for example, the Error case, the compiler will let us know:\nYou forgot to handle a possible case here, for example: | Error(_) Here’s Elm:\ntype RemoteData d e = Idle | Loading | Ready d | Error e renderRemoteData : RemoteData String String -\u003e String renderRemoteData data = case data of Idle -\u003e \"Idle\" Loading -\u003e \"Loading\" Ready(_) -\u003e \"Ready\" Error(_) -\u003e \"Error\" If we forget, say, Loading variant, we get one of those famous error messages:\nThis `case` does not have branches for all possibilities: 11|\u003e case data of 12|\u003e Idle -\u003e \"Idle\" 13|\u003e -- Loading -\u003e \"Loading\" 14|\u003e Ready(_) -\u003e \"Ready\" 15|\u003e Error(_) -\u003e \"Error\" Missing possibilities include: Loading I would have to crash if I saw one of those. Add branches for them! But we can trick TypeScript to perform the exhaustive check by introducing an impossible state:\nswitch (state._kind) { case 'Idle': return // ... case 'Loading': return // ... case 'Ready': return // ... case 'Error': return // ... default: const exhaustiveCheck: never = state; return exhaustiveCheck; } Although the error message is not as fancy as with other languages,\nType '{ _kind: \"Error\"; error: E; }' is not assignable to type 'never'. … it does the job.\nFolding I think there’s an even better way to handle our data type and help our users. What if we could reduce (or fold) the whole situation of 4 constructors and the data they carry to a single value? Here’s an idea:\nfunction fold\u003cD, E, R\u003e(state: RemoteData\u003cD, E\u003e): R { // magic } But that’s not all. Our users (including ourselves) will need to specify handlers for all of these options:\nconst data = Loading() // or Idle, or maybe Ready... who knows... fold(data, { Idle: () =\u003e 'idle', Loading: () =\u003e 'loading', Error: (_) =\u003e 'error', Ready: (_) =\u003e `ready`, }) Ah-ha! Our fold function should take a second argument:\nfunction fold\u003cD, E, R\u003e( state: RemoteData\u003cD, E\u003e matcher // Magic moves here ): R { // do the folding... } Let’s define a type for our matcher argument:\n// First, let's collect all the _kind literals type Kinds\u003cA, B\u003e = RemoteData\u003cA, B\u003e['_kind']; // This helper type pick one variant by _kind field type PickVariant\u003cA, B, K extends Kinds\u003cA, B\u003e\u003e = Extract\u003cRemoteData\u003cA, B\u003e, { _kind: K }\u003e; // Finally, we can construct an object // that has a function for each literal in _kind type Matchers\u003cD, E, R\u003e = { [K in Kinds\u003cA, B\u003e]: ( // here I'll just omit _kind field from function's argument args: Omit\u003cPickVariant\u003cA, B, K\u003e, \"_kind\"\u003e ) =\u003e R }; Now we can finish our fold implementation like this:\nfunction fold\u003cD, E, R\u003e( state: RemoteData\u003cD, E\u003e, matcher: Matchers\u003cD, E, R\u003e ): R { switch (state._kind) { case 'Idle': return matcher.Idle({}); case 'Loading': return matcher.Loading({}); case 'Ready': return matcher.Ready({ data: state.data }); case 'Error': return matcher.Error({ error: state.error }); default: const exhaustiveCheck: never = state; return exhaustiveCheck; } } All four? Every time? A common complaint I get about this approach is that people don’t want to deal with all the variants all the time. In fact, sometimes we just want to deal with a single case. In this case, due to the lack of pattern matching in TypeScript, we have to get creative. You see, in other languages you can specify a single branch for all the cases you don’t care about. For example, in Elm:\nrenderRemoteData : RemoteData String String -\u003e String renderRemoteData data = case data of Idle -\u003e \"Idle\" _ -\u003e \"whatever...\" main = Html.text \u003c| renderRemoteData \u003c| Loading This will render whatever... on the screen.\nWe can achieve a similar result in TypeScript by adding an additional type:\ntype MatcherWithDefault\u003cD, E, R\u003e = Partial\u003cMatchers\u003cD, E, R\u003e\u003e \u0026 { _: () =\u003e R } This type will be used for the matchers argument.\nfunction fold\u003cD, E, R\u003e( state: RemoteData\u003cD, E\u003e, matcher: Matchers\u003cD, E, R\u003e | MatcherWithDefault\u003cD, E, R\u003e ): R And this is how we would handle a variable now:\ncase 'Idle': return matcher.Idle ? matcher.Idle({}) : (matcher as MatcherWithDefault\u003cD, E, R\u003e)._(); Here’s the whole function:\nfunction fold\u003cD, E, R\u003e( state: RemoteData\u003cD, E\u003e, matcher: Matchers\u003cD, E, R\u003e | MatcherWithDefault\u003cD, E, R\u003e ): R { switch (state._kind) { case 'Idle': return matcher.Idle ? matcher.Idle({}) : (matcher as MatcherWithDefault\u003cD, E, R\u003e)._(); case 'Loading': return matcher.Loading ? matcher.Loading({}) : (matcher as MatcherWithDefault\u003cD, E, R\u003e)._(); case 'Ready': return matcher.Ready ? matcher.Ready({ data: state.data }) : (matcher as MatcherWithDefault\u003cD, E, R\u003e)._(); case 'Error': return matcher.Error ? matcher.Error({ error: state.error }) : (matcher as MatcherWithDefault\u003cD, E, R\u003e)._(); default: const exhaustiveCheck: never = state; return exhaustiveCheck; } } Now, finally, our users can chose if they want to handle all the cases, or provide a “catch all” branch:\nfold(Loading(), { Loading: () =\u003e 'loading', _: () =\u003e 'whatever...' }) Here’s a link to a TypeScript Playground with the code\n","wordCount":"1239","inLanguage":"en","datePublished":"2025-01-29T00:00:00Z","dateModified":"2025-01-29T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ivan-demchenko.github.io/blog/remote-data-as-data/"},"publisher":{"@type":"Organization","name":"Ivan's blog","logo":{"@type":"ImageObject","url":"https://ivan-demchenko.github.io/static/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ivan-demchenko.github.io/ accesskey=h title="Ivan's blog (Alt + H)">Ivan's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ivan-demchenko.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://ivan-demchenko.github.io/about/ title=About><span>About</span></a></li><li><a href=https://ivan-demchenko.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ivan-demchenko.github.io/bookmarks/ title=Bookmarks><span>Bookmarks</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Remote Data as Data</h1><div class=post-meta><span title='2025-01-29 00:00:00 +0000 UTC'>January 29, 2025</span>&nbsp;·&nbsp;6 min&nbsp;|&nbsp;<a href=https://github.com/ivan-demchenko/ivan-demchenko.github.io/blog/2025-01-29-remote-data.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Today I want to talk about an interesting (though not new) idea for representing remote resources. In fact, any resource that takes some time to retrieve. But most often we talk about network resources. At the same time, we&rsquo;re going to do a bit of TypeScript gymnastics.</p><h2 id=data-type-for-side-effects>Data type for side effects<a hidden class=anchor aria-hidden=true href=#data-type-for-side-effects>#</a></h2><p>The state of a remote resource can be represented in four ways:</p><ul><li><code>Idle</code> - we haven&rsquo;t even requested the resource yet</li><li><code>Loading</code> - we have requested the resource, but the operation is not yet complete</li><li><code>Ready&lt;D></code> - we have the data</li><li><code>Error&lt;E></code> - something has gone wrong</li></ul><p>So, using a discriminated union feature of TypeScript, we can create a type for this situation:</p><ul><li><code>RemoteData&lt;D, E></code></li></ul><p>Now we need some way(s) to construct a value of this type. Each of the variants we listed above is a constructor. Here&rsquo;s how we can construct them:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Idle</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> ({ <span style=color:#a6e22e>_kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Idle&#39;</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span> });
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Loading</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> ({ <span style=color:#a6e22e>_kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Loading&#39;</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span> });
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Ready</span> <span style=color:#f92672>=</span> &lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> &gt;(<span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>D</span>) <span style=color:#f92672>=&gt;</span> ({ <span style=color:#a6e22e>_kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Ready&#39;</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>, <span style=color:#a6e22e>data</span> });
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> Error <span style=color:#f92672>=</span> &lt;<span style=color:#f92672>E</span><span style=color:#960050;background-color:#1e0010>,</span> &gt;(<span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>E</span>) <span style=color:#f92672>=&gt;</span> ({ <span style=color:#a6e22e>_kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Error&#39;</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>, <span style=color:#a6e22e>error</span> });
</span></span></code></pre></div><p>Those are just simple functions that return simple objects. Please note <code>as const</code> that help to narrow the type from <code>string</code> to a corresponding literal.
Using a <code>ReturnType</code> utility we can reuse those constructors the following way:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RemoteData</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span>&gt; <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>ReturnType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>Idle</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>ReturnType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>Loading</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>ReturnType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>Ready</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>D</span>&gt;<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>ReturnType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>Error</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>E</span>&gt;<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>Therefore, the <code>_kind</code> field acts as a discriminator for this union type.</p><p>Okay, now we can use this type in other function. For example,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>renderRemoteString</span>(<span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>string</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>SomeError</span>&gt;) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>At this point, we need to talk about a mental model for <a href=https://en.wikipedia.org/wiki/Algebraic_data_type>Sum types</a> (or discriminated unions). All these constructors return a value of type <code>RemoteData&lt;D, E></code>. In other words, the value of type <code>RemoteData&lt;D, E></code> can be constructed in 4 ways. Therefore, within the <code>renderRemoteString</code> function, we don&rsquo;t really know which constructor has been used. So we need to deal with all 4:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>renderRemoteString</span>(<span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>string</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>SomeError</span>&gt;) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>_kind</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Idle&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Loading&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Ready&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Error&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>However, TypeScript doesn&rsquo;t force us to handle all cases in this <code>switch</code>. Other languages do though. Let&rsquo;s have a look. This is <a href=https://rescript-lang.org/docs/manual/v11.0.0/pattern-matching-destructuring>Rescript</a>:</p><pre tabindex=0><code class=language-rescript data-lang=rescript>type remoteData&lt;&#39;d, &#39;e&gt; =
	| Idle
	| Loading
	| Ready(&#39;d)
	| Error(&#39;e)

let render = (data: remoteData&lt;&#39;d, &#39;e&gt;) =&gt;
  switch data {
  | Idle =&gt; &#34;idle&#34;
  | Loading =&gt; &#34;Loading&#34;
  | Ready(_data) =&gt; &#34;Ready&#34;
  | Error(_err) =&gt; &#34;Error&#34;
  }
</code></pre><p>if we &ldquo;forget&rdquo; about, for example, the <code>Error</code> case, the compiler will let us know:</p><pre tabindex=0><code>You forgot to handle a possible case here, for example: 
  | Error(_)
</code></pre><p>Here&rsquo;s <a href=https://guide.elm-lang.org/types/custom_types>Elm</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#66d9ef>RemoteData</span> d e
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>=</span> <span style=color:#66d9ef>Idle</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>|</span> <span style=color:#66d9ef>Loading</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>|</span> <span style=color:#66d9ef>Ready</span> d
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>|</span> <span style=color:#66d9ef>Error</span> e
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>renderRemoteData <span style=color:#a6e22e>:</span> <span style=color:#66d9ef>RemoteData</span> <span style=color:#66d9ef>String</span> <span style=color:#66d9ef>String</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>String</span>
</span></span><span style=display:flex><span>renderRemoteData data <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> data <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Idle</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#e6db74>&#34;Idle&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Loading</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#e6db74>&#34;Loading&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Ready</span>(_) <span style=color:#a6e22e>-&gt;</span> <span style=color:#e6db74>&#34;Ready&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Error</span>(_) <span style=color:#a6e22e>-&gt;</span> <span style=color:#e6db74>&#34;Error&#34;</span>
</span></span></code></pre></div><p>If we forget, say, <code>Loading</code> variant, we get one of those famous error messages:</p><pre tabindex=0><code>This `case` does not have branches for all possibilities:

11|&gt;  case data of
12|&gt;    Idle -&gt; &#34;Idle&#34;
13|&gt;    -- Loading -&gt; &#34;Loading&#34;
14|&gt;    Ready(_) -&gt; &#34;Ready&#34;
15|&gt;    Error(_) -&gt; &#34;Error&#34;

Missing possibilities include:

    Loading

I would have to crash if I saw one of those. Add branches for them!
</code></pre><p>But we can trick TypeScript to perform the <a href=https://gibbok.github.io/typescript-book/book/exhaustiveness-checking/>exhaustive check</a> by introducing an impossible state:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>_kind</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Idle&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Loading&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Ready&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Error&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>exhaustiveCheck</span>: <span style=color:#66d9ef>never</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>exhaustiveCheck</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Although the error message is not as fancy as with other languages,</p><pre tabindex=0><code>Type &#39;{ _kind: &#34;Error&#34;; error: E; }&#39; is not assignable to type &#39;never&#39;.
</code></pre><p>&mldr; it does the job.</p><h2 id=folding>Folding<a hidden class=anchor aria-hidden=true href=#folding>#</a></h2><p>I think there&rsquo;s an even better way to handle our data type and help our users. What if we could reduce (or fold) the whole situation of 4 constructors and the data they carry to a single value? Here&rsquo;s an idea:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fold</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;(<span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>R</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// magic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>But that&rsquo;s not all. Our users (including ourselves) will need to specify handlers for all of these options:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Loading</span>() <span style=color:#75715e>// or Idle, or maybe Ready... who knows...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fold</span>(<span style=color:#a6e22e>data</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Idle</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;idle&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Loading</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;loading&#39;</span>,
</span></span><span style=display:flex><span>  Error<span style=color:#f92672>:</span> (<span style=color:#a6e22e>_</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;error&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Ready</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>_</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>`ready`</span>,
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>Ah-ha! Our <code>fold</code> function should take a second argument:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fold</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>matcher</span> <span style=color:#75715e>// Magic moves here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>R</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// do the folding...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Let&rsquo;s define a type for our <code>matcher</code> argument:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#75715e>// First, let&#39;s collect all the _kind literals
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Kinds</span>&lt;<span style=color:#f92672>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span>&gt; <span style=color:#f92672>=</span> <span style=color:#a6e22e>RemoteData</span>&lt;<span style=color:#f92672>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span>&gt;[<span style=color:#e6db74>&#39;_kind&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This helper type pick one variant by _kind field
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>PickVariant</span>&lt;<span style=color:#f92672>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>K</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>Kinds</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span>&gt;<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>=</span> <span style=color:#a6e22e>Extract</span>&lt;<span style=color:#f92672>RemoteData</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span>&gt;, { <span style=color:#a6e22e>_kind</span>: <span style=color:#66d9ef>K</span> }<span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Finally, we can construct an object
</span></span></span><span style=display:flex><span><span style=color:#75715e>// that has a function for each literal in _kind
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Matchers</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt; <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>K</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>Kinds</span>&lt;<span style=color:#f92672>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span>&gt;]<span style=color:#f92672>:</span> (
</span></span><span style=display:flex><span>    <span style=color:#75715e>// here I&#39;ll just omit _kind field from function&#39;s argument
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>Omit</span>&lt;<span style=color:#f92672>PickVariant</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>A</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>B</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>K</span>&gt;, <span style=color:#e6db74>&#34;_kind&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  ) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>R</span>
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Now we can finish our <code>fold</code> implementation like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fold</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span>&gt;,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>matcher</span>: <span style=color:#66d9ef>Matchers</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>R</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>_kind</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Idle&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Idle</span>({});
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Loading&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Loading</span>({});
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Ready&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Ready</span>({ <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>state.data</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Error&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.Error({ <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>state.error</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>exhaustiveCheck</span>: <span style=color:#66d9ef>never</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>exhaustiveCheck</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=all-four-every-time>All four? Every time?<a hidden class=anchor aria-hidden=true href=#all-four-every-time>#</a></h2><p>A common complaint I get about this approach is that people don&rsquo;t want to deal with all the variants all the time. In fact, sometimes we just want to deal with a single case. In this case, due to the lack of <a href=https://en.wikipedia.org/wiki/Pattern_matching>pattern matching</a> in TypeScript, we have to get creative. You see, in other languages you can specify a single branch for all the cases you don&rsquo;t care about. For example, in Elm:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elm data-lang=elm><span style=display:flex><span>renderRemoteData <span style=color:#a6e22e>:</span> <span style=color:#66d9ef>RemoteData</span> <span style=color:#66d9ef>String</span> <span style=color:#66d9ef>String</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#66d9ef>String</span>
</span></span><span style=display:flex><span>renderRemoteData data <span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> data <span style=color:#66d9ef>of</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Idle</span> <span style=color:#a6e22e>-&gt;</span> <span style=color:#e6db74>&#34;Idle&#34;</span>
</span></span><span style=display:flex><span>    _ <span style=color:#a6e22e>-&gt;</span> <span style=color:#e6db74>&#34;whatever...&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>main </span><span style=color:#a6e22e>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>Html</span><span style=color:#a6e22e>.</span>text <span style=color:#a6e22e>&lt;|</span> renderRemoteData <span style=color:#a6e22e>&lt;|</span> <span style=color:#66d9ef>Loading</span>
</span></span></code></pre></div><p>This will render <code>whatever...</code> on the screen.</p><p>We can achieve a similar result in TypeScript by adding an additional type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt; <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Partial</span>&lt;<span style=color:#f92672>Matchers</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;<span style=color:#f92672>&gt;</span> <span style=color:#f92672>&amp;</span> { <span style=color:#a6e22e>_</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>R</span> }
</span></span></code></pre></div><p>This type will be used for the <code>matchers</code> argument.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fold</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span>&gt;,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>matcher</span>: <span style=color:#66d9ef>Matchers</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt; <span style=color:#f92672>|</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>R</span>
</span></span></code></pre></div><p>And this is how we would handle a variable now:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Idle&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Idle</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>?</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Idle</span>({})
</span></span><span style=display:flex><span>  <span style=color:#f92672>:</span> (<span style=color:#a6e22e>matcher</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;).<span style=color:#a6e22e>_</span>();
</span></span></code></pre></div><p>Here&rsquo;s the whole function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>fold</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>RemoteData</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span>&gt;,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>matcher</span>: <span style=color:#66d9ef>Matchers</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt; <span style=color:#f92672>|</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>R</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>_kind</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Idle&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Idle</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>?</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Idle</span>({})
</span></span><span style=display:flex><span>      <span style=color:#f92672>:</span> (<span style=color:#a6e22e>matcher</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;).<span style=color:#a6e22e>_</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Loading&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Loading</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>?</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Loading</span>({})
</span></span><span style=display:flex><span>      <span style=color:#f92672>:</span> (<span style=color:#a6e22e>matcher</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;).<span style=color:#a6e22e>_</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Ready&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Ready</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>?</span> <span style=color:#a6e22e>matcher</span>.<span style=color:#a6e22e>Ready</span>({ <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>state.data</span> })
</span></span><span style=display:flex><span>      <span style=color:#f92672>:</span> (<span style=color:#a6e22e>matcher</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;).<span style=color:#a6e22e>_</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;Error&#39;</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matcher</span>.Error <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>matcher</span>.Error({ <span style=color:#a6e22e>error</span>: <span style=color:#66d9ef>state.error</span> })
</span></span><span style=display:flex><span>      <span style=color:#f92672>:</span> (<span style=color:#a6e22e>matcher</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>MatcherWithDefault</span>&lt;<span style=color:#f92672>D</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>E</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>R</span>&gt;).<span style=color:#a6e22e>_</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>exhaustiveCheck</span>: <span style=color:#66d9ef>never</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>exhaustiveCheck</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, finally, our users can chose if they want to handle all the cases, or provide a &ldquo;catch all&rdquo; branch:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>fold</span>(<span style=color:#a6e22e>Loading</span>(), {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Loading</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;loading&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;whatever...&#39;</span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>Here&rsquo;s a link to a <a href="https://www.typescriptlang.org/play/?noFallthroughCasesInSwitch=true#code/HYQwtgpgzgDiDGEAEAlCYD2AXCAREWISA3gFBIVIQAeMGATlkvBsFEwJIAmANsgLxIAFAEok-AHzDiSAPoBrAJbAuALiQBybnw1IQUZq3ZIAviIDc5SjTqNDbJgBkMILsoDm44WMnS5SlXUNZ1cPXX17YzNLSipaBiYWB1QIVwBPLwAeABUAGiQJIS4CEHVsnykhGQVlNU00dPCDJPZ84sJTCysKGwTIpgBRenoGLIH8wohhhnUBir8awM0hkfom-vyp1c7LbrjbJiw0mGQAZUIcHPyBqX492IAfFKwAV3pgbOOITKOTjAAzJDaCASe6UJ5oV7vT4nH5fAFIEJuYDuUGxR7PN4fL5wv6AhpcNI5CRo9EUCEQKHY2G-CAIlYMTI3UF7WlIADStSgmQAgvkAEK3JDnAjfPlIQUAbQ0iy4GgAujFKGyAAqKeDyABqIHoihAwCwvIF+XZcRwKgMnItRolJK8A2oWHoCENIsu4sF+WqATqppMEl2sTZAFkCPAABZTbke-IoIVkMkUSWm5Qcrk2wXy9RCHXuKDqADyYEUhrVGu1uv1hpjHIk+QARLL6xJ5ig9iZA8qvkhQ1gI1MAOol8O4CD-EAvHjV42oIUqnVYPU8TK9-v0aMzuNSABkJDk2dbpj2e16dn+L2A8EXrCQ-wwPC4VyQ41nQjBFHYovUbu+eWfdffJAwDDSN6HUVdQO5P8XzjJAnggwdh1HcdJ0NaDY1JCgRHUFASEAqAAHcSwjYRPxwAA6WUxATRNYngfRkC0XgIA0dR6EpLEgJAqZyOBJAAH4uL7UDeOYqozCQbNgOEqY9AMBD6CHLARzHCcpyfGCW0o0QlVoih6KgRikTCNiOPeIS13I4yUQEiyROs9xxLEKTuPoOSe1cpSVJQ9T0NnERtK6PTKAMxiCTSVikHYqk7J48LbOkyzwqqJB2lKJAyIgci0s6SThES0D3IUrzkLUtDrgwgLZB0wC6IY5ZpjWUyYoKniGTcwTWvocj2pSrYZgyi4sv6tyJJcmS3IiYqkNU1CNMqwLdL0rhZqnVRasTFomBocMJ3YRQADcIAAYUjDV1GACAjrcwRMqW4KKGizidr2xcjtOiANXuygTHbUhftINBMBwfBCHIu8HyEIHsDwEorJcZFHJEL09gcg9xCkDQeARsJcj2WR0d8DQCN2nBrvIimNH+kQgA">TypeScript Playground</a> with the code</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ivan-demchenko.github.io/tags/typescript/>typescript</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://ivan-demchenko.github.io/>Ivan's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/javascript>var sc_project=12781072,sc_invisible=1,sc_security="4d31877b"</script><script type=text/javascript src=https://www.statcounter.com/counter/counter.js async></script><noscript><div class=statcounter><a title="Web Analytics" href=https://statcounter.com/ target=_blank><img class=statcounter src=https://c.statcounter.com/12781072/0/4d31877b/1/ alt="Web Analytics" referrerpolicy=no-referrer-when-downgrade></a></div></noscript><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>