<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>UI library as a mono-repository. Part 3 | Ivan's blog</title><meta name=keywords content="front-end,architecture"><meta name=description content="As we progressed with our mono-repository endeavour, we noticed some weird behaviour. It worked like charm in the apps. But not in our Storybook. Besides, sometimes tests would fail for no obvious reason.
Storybook is a de-facto standard tool for developing and demonstrating your components in action in the real environment. We also used Jest for testing. So, naturally, we didn&rsquo;t want to give them up. Seems like our setup is not finished yet."><meta name=author content><link rel=canonical href=https://raqystyle.github.io/blog/ui-lib-monorepo-part3/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://raqystyle.github.io/static/icon.png><link rel=icon type=image/png sizes=16x16 href=https://raqystyle.github.io/static/icon16.png><link rel=icon type=image/png sizes=32x32 href=https://raqystyle.github.io/static/icon32.png><link rel=apple-touch-icon href=https://raqystyle.github.io/static/icon.png><link rel=mask-icon href=https://raqystyle.github.io/static/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VHCCQB5KTN"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VHCCQB5KTN")</script><meta property="og:title" content="UI library as a mono-repository. Part 3"><meta property="og:description" content="As we progressed with our mono-repository endeavour, we noticed some weird behaviour. It worked like charm in the apps. But not in our Storybook. Besides, sometimes tests would fail for no obvious reason.
Storybook is a de-facto standard tool for developing and demonstrating your components in action in the real environment. We also used Jest for testing. So, naturally, we didn&rsquo;t want to give them up. Seems like our setup is not finished yet."><meta property="og:type" content="article"><meta property="og:url" content="https://raqystyle.github.io/blog/ui-lib-monorepo-part3/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-10-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="UI library as a mono-repository. Part 3"><meta name=twitter:description content="As we progressed with our mono-repository endeavour, we noticed some weird behaviour. It worked like charm in the apps. But not in our Storybook. Besides, sometimes tests would fail for no obvious reason.
Storybook is a de-facto standard tool for developing and demonstrating your components in action in the real environment. We also used Jest for testing. So, naturally, we didn&rsquo;t want to give them up. Seems like our setup is not finished yet."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://raqystyle.github.io/blog/"},{"@type":"ListItem","position":2,"name":"UI library as a mono-repository. Part 3","item":"https://raqystyle.github.io/blog/ui-lib-monorepo-part3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"UI library as a mono-repository. Part 3","name":"UI library as a mono-repository. Part 3","description":"As we progressed with our mono-repository endeavour, we noticed some weird behaviour. It worked like charm in the apps. But not in our Storybook. Besides, sometimes tests would fail for no obvious reason.\nStorybook is a de-facto standard tool for developing and demonstrating your components in action in the real environment. We also used Jest for testing. So, naturally, we didn\u0026rsquo;t want to give them up. Seems like our setup is not finished yet.","keywords":["front-end","architecture"],"articleBody":"As we progressed with our mono-repository endeavour, we noticed some weird behaviour. It worked like charm in the apps. But not in our Storybook. Besides, sometimes tests would fail for no obvious reason.\nStorybook is a de-facto standard tool for developing and demonstrating your components in action in the real environment. We also used Jest for testing. So, naturally, we didnâ€™t want to give them up. Seems like our setup is not finished yet.\nIn mono-repository, components reference other components by package names:\n// button.tsx import { Icon } from \"@highlight-ui/icon\"; Thus, when we build the components, the dist folder will be used (dependency resolution process algorithm) as hashing of CSS classes will be different and the plugin that generates props tables will not work and if thereâ€™s no dist folder then files are not found ðŸ˜±.\nThe Storybook setup tweaks We needed to make sure our Storybook always use source files.\nWebpack is a mighty beast (to say the least). We decided to extend the resolution process. We needed a way to point resolvers to source files for our packages.\nAs such, we needed to add fields with references to source files entry points:\n{ \"name\": \"@highlight-ui/button\", \"version\": \"8.0.1\", // ... \"main\": \"dist/cjs/index.js\", \"module\": \"dist/esm/index.js\", \"types\": \"dist/cjs/index.d.ts\", \"style\": \"dist/esm/index.css\", \"src:scss\": \"./index.scss\", \"src:ts\": \"./index.ts\", // ... } We already had index.ts files in our packages and we only needed to add index.scss files. These files are intended for local use only. Remember, we treat CSS dependencies the same way we treat JS dependencies.\n// packages/ui/button/index.scss @import \"./src/Button.module\"; Now as itâ€™s all set, first, we can tell Webpack to look for src:ts field in the package.json file:\nwebpackFinal: async (config) =\u003e { // ... config.resolve.mainFields.unshift(\"src:ts\"); // ... return config; }; Now we need to adapt the configuration for Sass files. Look, we can tweak the resolution process based on the test field (more and more):\n{ test: /\\.s[ac]ss$/i, use: [ /* loaders */ ], // rest of the config resolve: { mainFields: ['src:scss', 'style'], }, } This is what our final Webpack config looks like:\nwebpackFinal: (config) =\u003e { config.resolve.mainFields.unshift('src:ts'); const extraRules = [ { test: /\\.css$/i, resolve: { mainFields: ['src:scss', 'style'], }, }, { test: /\\.s[ac]ss$/i, use: [ 'style-loader', { loader: 'css-loader', options: { ... }, }, { loader: 'sass-loader', options: { ... }, }, ], sideEffects: true, include: path.resolve(__dirname, '..'), resolve: { mainFields: ['src:scss', 'style'], }, }, ]; config.module.rules.push(...extraRules); return config; }, Read more about Webpack rules here.\nTweaking Jest Knowing all of this, configuring Jest was trivial. Jest allows customising the resolution process via custom resolvers:\n{ // base-jest/index.js module.exports = { ... resolver: path.join(__dirname, 'resolver.js'), ... } } Secondly, we need to create a resolver:\nmodule.exports = (request, options) =\u003e { // Call the defaultResolver, so we leverage its cache, error handling, etc. return options.defaultResolver(request, { ...options, packageFilter: (pkg) =\u003e ({ ...pkg, main: pkg[\"src:ts\"] || pkg.main, }), }); }; Notice how we simply add a field - src:ts - to look for. If thereâ€™s no such field in the package.json file, it will keep looking for other default fields.\nConclusion Now it doesnâ€™t matter if packages have dist folders or not. Source files will always be used instead. Technically, itâ€™d be great to be able to run Storybook against dist folders. This way you could verify what exactly do consumers get before publishing. However, this is relatively easy to achieve using a simple flag.\n","wordCount":"567","inLanguage":"en","datePublished":"2021-10-27T00:00:00Z","dateModified":"2021-10-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://raqystyle.github.io/blog/ui-lib-monorepo-part3/"},"publisher":{"@type":"Organization","name":"Ivan's blog","logo":{"@type":"ImageObject","url":"https://raqystyle.github.io/static/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://raqystyle.github.io/ accesskey=h title="Ivan's blog (Alt + H)">Ivan's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://raqystyle.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://raqystyle.github.io/about/ title=About><span>About</span></a></li><li><a href=https://raqystyle.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://raqystyle.github.io/bookmarks/ title=Bookmarks><span>Bookmarks</span></a></li><li><a href=https://raqystyle.github.io/cv/ title=CV><span>CV</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>UI library as a mono-repository. Part 3</h1><div class=post-meta><span title='2021-10-27 00:00:00 +0000 UTC'>October 27, 2021</span>&nbsp;Â·&nbsp;3 min&nbsp;|&nbsp;<a href=https://github.com/raqystyle/raqystyle.github.io/content/blog/ui-lib-monorepo-part3/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>As we progressed with our mono-repository endeavour, we noticed some weird behaviour. It worked like charm in the apps. But not in our Storybook. Besides, sometimes tests would fail for no obvious reason.</p><p>Storybook is a de-facto standard tool for developing and demonstrating your components in action in the real environment. We also used Jest for testing. So, naturally, we didn&rsquo;t want to give them up. Seems like our setup is not finished yet.</p><p>In mono-repository, components reference other components by package names:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#75715e>// button.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Icon</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@highlight-ui/icon&#34;</span>;
</span></span></code></pre></div><p>Thus, when we build the components, the <code>dist</code> folder will be used (dependency resolution process algorithm) as hashing of CSS classes will be different and the plugin that generates props tables will not work and if thereâ€™s no <code>dist</code> folder then files are not found ðŸ˜±.</p><h2 id=the-storybook-setup-tweaks>The Storybook setup tweaks<a hidden class=anchor aria-hidden=true href=#the-storybook-setup-tweaks>#</a></h2><p>We needed to make sure our Storybook always use source files.</p><p>Webpack is a mighty beast (to say the least). We decided to extend the resolution process. We needed a way to point resolvers to source files for our packages.</p><p>As such, we needed to add fields with references to source files entry points:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;@highlight-ui/button&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;8.0.1&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;dist/cjs/index.js&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;module&#34;</span>: <span style=color:#e6db74>&#34;dist/esm/index.js&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;types&#34;</span>: <span style=color:#e6db74>&#34;dist/cjs/index.d.ts&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;style&#34;</span>: <span style=color:#e6db74>&#34;dist/esm/index.css&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#f92672>&#34;src:scss&#34;</span>: <span style=color:#e6db74>&#34;./index.scss&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#f92672>&#34;src:ts&#34;</span>: <span style=color:#e6db74>&#34;./index.ts&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>We already had <code>index.ts</code> files in our packages and we only needed to add <code>index.scss</code> files. These files are intended for local use only. Remember, we treat CSS dependencies the same way we treat JS dependencies.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scss data-lang=scss><span style=display:flex><span><span style=color:#75715e>// packages/ui/button/index.scss
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>@import</span> <span style=color:#e6db74>&#34;./src/Button.module&#34;</span>;
</span></span></code></pre></div><p>Now as itâ€™s all set, first, we can tell Webpack to look for <code>src:ts</code> field in the <code>package.json</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>webpackFinal</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>config</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>resolve</span>.<span style=color:#a6e22e>mainFields</span>.<span style=color:#a6e22e>unshift</span>(<span style=color:#e6db74>&#34;src:ts&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>config</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Now we need to adapt the configuration for Sass files. Look, we can tweak the resolution process based on the test field (<a href=https://webpack.js.org/configuration/module/#ruletest>more</a> and <a href=https://github.com/webpack/webpack/blob/4837c3ddb9da8e676c73d97460e19689dd9d4691/test/configCases/resolve-merging/override/webpack.config.js>more</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.s[ac]ss$/i</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>use</span><span style=color:#f92672>:</span> [ <span style=color:#75715e>/* loaders */</span> ],
</span></span><span style=display:flex><span>  <span style=color:#75715e>// rest of the config
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>resolve</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>mainFields</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;src:scss&#39;</span>, <span style=color:#e6db74>&#39;style&#39;</span>],
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is what our final Webpack config looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>webpackFinal</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>config</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>resolve</span>.<span style=color:#a6e22e>mainFields</span>.<span style=color:#a6e22e>unshift</span>(<span style=color:#e6db74>&#39;src:ts&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>extraRules</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.css$/i</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>resolve</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>mainFields</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;src:scss&#39;</span>, <span style=color:#e6db74>&#39;style&#39;</span>],
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.s[ac]ss$/i</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>use</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;style-loader&#39;</span>,
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;css-loader&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>options</span><span style=color:#f92672>:</span> { ... },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;sass-loader&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>options</span><span style=color:#f92672>:</span> { ... },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>sideEffects</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>include</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;..&#39;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>resolve</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>mainFields</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;src:scss&#39;</span>, <span style=color:#e6db74>&#39;style&#39;</span>],
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>rules</span>.<span style=color:#a6e22e>push</span>(...<span style=color:#a6e22e>extraRules</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>config</span>;
</span></span><span style=display:flex><span>},
</span></span></code></pre></div><p>Read more about Webpack rules <a href=https://webpack.js.org/configuration/module/#rule>here</a>.</p><h2 id=tweaking-jest>Tweaking Jest<a hidden class=anchor aria-hidden=true href=#tweaking-jest>#</a></h2><p>Knowing all of this, configuring Jest was trivial. Jest allows customising the resolution process via custom resolvers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#75715e>// base-jest/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resolver</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;resolver.js&#39;</span>),
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Secondly, we need to create a resolver:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>options</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Call the defaultResolver, so we leverage its cache, error handling, etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>defaultResolver</span>(<span style=color:#a6e22e>request</span>, {
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>options</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>packageFilter</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>pkg</span>) =&gt; ({
</span></span><span style=display:flex><span>      ...<span style=color:#a6e22e>pkg</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>main</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pkg</span>[<span style=color:#e6db74>&#34;src:ts&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>pkg</span>.<span style=color:#a6e22e>main</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Notice how we simply add a field - <code>src:ts</code> - to look for. If there&rsquo;s no such field in the <code>package.json</code> file, it will keep looking for other default fields.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Now it doesn&rsquo;t matter if packages have <code>dist</code> folders or not. Source files will always be used instead. Technically, it&rsquo;d be great to be able to run Storybook against <code>dist</code> folders. This way you could verify what exactly do consumers get before publishing. However, this is relatively easy to achieve using a simple flag.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://raqystyle.github.io/tags/front-end/>front-end</a></li><li><a href=https://raqystyle.github.io/tags/architecture/>architecture</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://raqystyle.github.io/>Ivan's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/javascript>var sc_project=12781072,sc_invisible=1,sc_security="4d31877b"</script><script type=text/javascript src=https://www.statcounter.com/counter/counter.js async></script><noscript><div class=statcounter><a title="Web Analytics" href=https://statcounter.com/ target=_blank><img class=statcounter src=https://c.statcounter.com/12781072/0/4d31877b/1/ alt="Web Analytics" referrerpolicy=no-referrer-when-downgrade></a></div></noscript><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>