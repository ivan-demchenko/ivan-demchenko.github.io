<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>UI library as a mono-repository. Part 2 | Ivan's blog</title><meta name=keywords content="front-end,architecture"><meta name=description content="Let&rsquo;s talk about CSS files and modules. Unfortunately, they are often treated as if they were a second class entities. We need to fix this situation.
Treating CSS dependencies the way we treat other dependencies Let&rsquo;s talk about the dependencies between UI components.
In JS files, we mark dependencies by import-ing or require-ing them. Packages clearly define dependencies in the package.json file. But a package is not only JS files, but also CSS files."><meta name=author content><link rel=canonical href=https://ivan-demchenko.github.io/blog/ui-lib-monorepo-part2/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ivan-demchenko.github.io/static/icon.png><link rel=icon type=image/png sizes=16x16 href=https://ivan-demchenko.github.io/static/icon16.png><link rel=icon type=image/png sizes=32x32 href=https://ivan-demchenko.github.io/static/icon32.png><link rel=apple-touch-icon href=https://ivan-demchenko.github.io/static/icon.png><link rel=mask-icon href=https://ivan-demchenko.github.io/static/icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VHCCQB5KTN"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VHCCQB5KTN")</script><meta property="og:title" content="UI library as a mono-repository. Part 2"><meta property="og:description" content="Let&rsquo;s talk about CSS files and modules. Unfortunately, they are often treated as if they were a second class entities. We need to fix this situation.
Treating CSS dependencies the way we treat other dependencies Let&rsquo;s talk about the dependencies between UI components.
In JS files, we mark dependencies by import-ing or require-ing them. Packages clearly define dependencies in the package.json file. But a package is not only JS files, but also CSS files."><meta property="og:type" content="article"><meta property="og:url" content="https://ivan-demchenko.github.io/blog/ui-lib-monorepo-part2/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-10-26T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="UI library as a mono-repository. Part 2"><meta name=twitter:description content="Let&rsquo;s talk about CSS files and modules. Unfortunately, they are often treated as if they were a second class entities. We need to fix this situation.
Treating CSS dependencies the way we treat other dependencies Let&rsquo;s talk about the dependencies between UI components.
In JS files, we mark dependencies by import-ing or require-ing them. Packages clearly define dependencies in the package.json file. But a package is not only JS files, but also CSS files."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://ivan-demchenko.github.io/blog/"},{"@type":"ListItem","position":2,"name":"UI library as a mono-repository. Part 2","item":"https://ivan-demchenko.github.io/blog/ui-lib-monorepo-part2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"UI library as a mono-repository. Part 2","name":"UI library as a mono-repository. Part 2","description":"Let\u0026rsquo;s talk about CSS files and modules. Unfortunately, they are often treated as if they were a second class entities. We need to fix this situation.\nTreating CSS dependencies the way we treat other dependencies Let\u0026rsquo;s talk about the dependencies between UI components.\nIn JS files, we mark dependencies by import-ing or require-ing them. Packages clearly define dependencies in the package.json file. But a package is not only JS files, but also CSS files.","keywords":["front-end","architecture"],"articleBody":"Let’s talk about CSS files and modules. Unfortunately, they are often treated as if they were a second class entities. We need to fix this situation.\nTreating CSS dependencies the way we treat other dependencies Let’s talk about the dependencies between UI components.\nIn JS files, we mark dependencies by import-ing or require-ing them. Packages clearly define dependencies in the package.json file. But a package is not only JS files, but also CSS files.\nConsider a typical app:\nBasically, it is a directed graph of dependencies between components. This is our mental model - JS files that reference each other. And it works well as each of those app-specific components import their CSS file and a bundler takes care of reducing all this to 2-3 files.\nBut let’s keep in mind that we’re building a set of NPM packages that contain JS and CSS files. For example, the Button package depends on the Icon package. This means, there’s a dependency between JS and CSS files. However, typically, these relations are neglected.\n// button/index.js var Icon = require(\"@highlight-ui/icon\"); /* button/index.css */ /* where's my Icon? */ .Button-module { /*...*/ } Therefore, we decided to introduce such dependency declarations in CSS files as well.\nThis way, we get the full picture, like shown on this diagram:\nLet’s test it Let’s make our Button’s Sass file include the dependency:\njust as we do in the TS file:\nThe resulting build looks like this:\nAt this moment, we have the Button at version 3.0.0, which depends on the Icon at version 2.0.6.\nGreat. Now, let’s go back to our App and install the Button package. We used yalc for the local experiments as it replicated the whole release-publish-install cycle:\nNow let’s use the Button in our App. This the app.tsx:\nIn our App we have a special file where we @include the CSS of our components.\nWhen we built it, we got the following results:\nNotice that because there was an @import in the Button’s CSS, Icon’s CSS was included as well, thanks to css-loader.\nHowever, what if our App already had Icon as a dependency? Let’s simulate this and install the Icon package of version, say, 2.0.1:\nTo summarise, the Button v3.0.0 depends on the Icon v2.0.6, our App depends on Icon v2.0.1 and the Button v3.0.0: Our dependency tree will look like this:\nNote: button package now has its node_modules with icon package.\nWe’ll include it in source files, app.tsx:\nas well as in the highlight-ui.scss:\nLet’s build it now and see what happens:\nOkay, both versions are there!\nHowever, what about JS? In JS we also reference CSS classes. Well, in the browser everything works as expected as well. This is the screenshot of Chrome DevTools:\nHow cool is that to have all these dependenceis visible here!\nConclusion It turned out that thinking about CSS files as any other software modules helps building a system of healthy relationship between these modules. I would like to invite to the Part 3: improving the developer experience\n","wordCount":"503","inLanguage":"en","datePublished":"2021-10-26T00:00:00Z","dateModified":"2021-10-26T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://ivan-demchenko.github.io/blog/ui-lib-monorepo-part2/"},"publisher":{"@type":"Organization","name":"Ivan's blog","logo":{"@type":"ImageObject","url":"https://ivan-demchenko.github.io/static/icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ivan-demchenko.github.io/ accesskey=h title="Ivan's blog (Alt + H)">Ivan's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ivan-demchenko.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://ivan-demchenko.github.io/about/ title=About><span>About</span></a></li><li><a href=https://ivan-demchenko.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ivan-demchenko.github.io/bookmarks/ title=Bookmarks><span>Bookmarks</span></a></li><li><a href=https://ivan-demchenko.github.io/cv/ title=CV><span>CV</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>UI library as a mono-repository. Part 2</h1><div class=post-meta><span title='2021-10-26 00:00:00 +0000 UTC'>October 26, 2021</span>&nbsp;·&nbsp;3 min&nbsp;|&nbsp;<a href=https://github.com/ivan-demchenko/ivan-demchenko.github.io/blog/ui-lib-monorepo-part2/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Let&rsquo;s talk about CSS files and modules. Unfortunately, they are often treated as if they were a second class entities. We need to fix this situation.</p><h2 id=treating-css-dependencies-the-way-we-treat-other-dependencies>Treating CSS dependencies the way we treat other dependencies<a hidden class=anchor aria-hidden=true href=#treating-css-dependencies-the-way-we-treat-other-dependencies>#</a></h2><p>Let&rsquo;s talk about the dependencies between UI components.</p><p>In JS files, we mark dependencies by <code>import</code>-ing or <code>require</code>-ing them. Packages clearly define dependencies in the <code>package.json</code> file. But a package is not only JS files, but also CSS files.</p><p>Consider a typical app:</p><p><img loading=lazy src=./c1p1.png alt="Typical structure of a React application"></p><p>Basically, it is a directed graph of dependencies between components. This is our mental model - JS files that reference each other. And it works well as each of those app-specific components import their CSS file and a bundler takes care of reducing all this to 2-3 files.</p><p>But let&rsquo;s keep in mind that we&rsquo;re building a set of NPM packages that contain JS and CSS files. For example, the <code>Button</code> package depends on the <code>Icon</code> package. This means, there&rsquo;s a dependency between JS <em>and CSS</em> files. However, typically, these relations are neglected.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// button/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>Icon</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;@highlight-ui/icon&#34;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* button/index.css */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* where&#39;s my Icon? */</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>Button-module</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>/*...*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Therefore, we decided to introduce such dependency declarations in CSS files as well.</p><p>This way, we get the full picture, like shown on this diagram:</p><p><img loading=lazy src=./c1p2.png alt="Dependencies between components"></p><h2 id=lets-test-it>Let’s test it<a hidden class=anchor aria-hidden=true href=#lets-test-it>#</a></h2><p>Let&rsquo;s make our Button’s Sass file include the dependency:</p><p><img loading=lazy src=./c1p3.png alt="Button includes the CSS of Icon as a dependency"></p><p>just as we do in the TS file:</p><p><img loading=lazy src=./c1p4.png alt="Button includes JS of Icon as a dependency"></p><p>The resulting build looks like this:</p><p><img loading=lazy src=./c1p5.png alt="Resulting CSS of Button"></p><p>At this moment, we have the Button at version 3.0.0, which depends on the Icon at version 2.0.6.</p><p>Great. Now, let’s go back to our App and install the Button package. We used <code>yalc</code> for the local experiments as it replicated the whole release-publish-install cycle:</p><p><img loading=lazy src=./c1p6.png alt="Importing local dependency using yalc"></p><p>Now let&rsquo;s use the Button in our App. This the <code>app.tsx</code>:</p><p><img loading=lazy src=./c1p7.png alt="Using Button component in the App"></p><p>In our App we have a special file where we <code>@include</code> the CSS of our components.</p><p><img loading=lazy src=./c1p8.png alt="Importing Button CSS in App CSS"></p><p>When we built it, we got the following results:</p><p><img loading=lazy src=./c1p9.png alt="The result of a build"></p><p>Notice that because there was an <code>@import</code> in the Button&rsquo;s CSS, Icon’s CSS was included as well, thanks to <code>css-loader</code>.</p><p>However, what if our App already had Icon as a dependency? Let’s simulate this and install the Icon package of version, say, 2.0.1:</p><p><img loading=lazy src=./c1p10.png alt="App depends on Button and Icon"></p><p>To summarise, the Button v3.0.0 depends on the Icon v2.0.6, our App depends on Icon v2.0.1 and the Button v3.0.0: Our dependency tree will look like this:</p><p><img loading=lazy src=./c1p11.png alt="File structure of dependencies"></p><p><em>Note: <code>button</code> package now has its <code>node_modules</code> with <code>icon</code> package.</em></p><p>We’ll include it in source files, <code>app.tsx</code>:</p><p><img loading=lazy src=./c1p12.png alt="App uses Icon and Button in JS"></p><p>as well as in the <code>highlight-ui.scss</code>:</p><p><img loading=lazy src=./c1p13.png alt="Include Icon CSS in App CSS"></p><p>Let’s build it now and see what happens:</p><p><img loading=lazy src=./c1p14.png alt="The final CSS contains two versions on Icon and Button"></p><p>Okay, both versions are there!</p><p>However, what about JS? In JS we also reference CSS classes. Well, in the browser everything works as expected as well. This is the screenshot of Chrome DevTools:</p><p><img loading=lazy src=./c1p15.png alt="In DevTools one can see different versions of Icon"></p><p>How cool is that to have all these dependenceis visible here!</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>It turned out that thinking about CSS files as any other software modules helps building a system of healthy relationship between these modules.
I would like to invite to <a href=/ui-lib-monorepo-part3/>the Part 3: improving the developer experience</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ivan-demchenko.github.io/tags/front-end/>front-end</a></li><li><a href=https://ivan-demchenko.github.io/tags/architecture/>architecture</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://ivan-demchenko.github.io/>Ivan's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script type=text/javascript>var sc_project=12781072,sc_invisible=1,sc_security="4d31877b"</script><script type=text/javascript src=https://www.statcounter.com/counter/counter.js async></script><noscript><div class=statcounter><a title="Web Analytics" href=https://statcounter.com/ target=_blank><img class=statcounter src=https://c.statcounter.com/12781072/0/4d31877b/1/ alt="Web Analytics" referrerpolicy=no-referrer-when-downgrade></a></div></noscript><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>